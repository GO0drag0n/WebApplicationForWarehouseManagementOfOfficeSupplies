@model IEnumerable<WebApplicationForWarehouseManagementOfOfficeSupplies.DTOs.ManageCategoriesViewModel>

@{
    ViewBag.Title = "Manage Categories";
}

<div class="container">
    <h2>Manage Categories</h2>

    <table class="table">
        <thead>
            <tr>
                <th>Category ID</th>
                <th>Unique Number</th>
                <th>Category Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var category in Model)
            {
                <tr>
                    <td>@category.CategoryID</td>
                    <td>@category.UniqueNumber</td>
                    <td>@category.CategoryName</td>
                    <td>
                        <button type="button" class="btn btn-primary btn-sm rename-btn"
                                data-category-id="@category.CategoryID"
                                data-category-name="@category.CategoryName"
                                data-unique-number="@category.UniqueNumber">
                            Rename
                        </button>
                        <button type="button" class="btn btn-danger btn-sm delete-btn"
                                data-category-id="@category.CategoryID"
                                data-category-name="@category.CategoryName"
                                data-product-count="@category.ProductCount">
                            Delete
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<!-- Rename Modal -->
<div class="modal fade" id="renameModal" tabindex="-1" role="dialog" aria-labelledby="renameModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form asp-action="RenameCategory" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="renameModalLabel">Rename Category</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Hidden field for the Category ID -->
                    <input type="hidden" id="renameCategoryID" name="CategoryID" value="" />
                    <input type="hidden" id="renameUniqueNumber" name="UniqueNumber" value="" />
                    <div class="form-group">
                        <label for="renameNewName">New Category Name</label>
                        <input type="text" class="form-control" id="renameNewName" name="CategoryName" required />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form asp-action="DeleteCategory" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="deleteModalMessage"></p>
                    <input type="hidden" id="deleteCategoryID" name="id" value="" />
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete Category</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $('.rename-btn').on('click', function () {
                var categoryId = $(this).data('category-id');
                var categoryName = $(this).data('category-name');
                var uniqueNumber = $(this).data('unique-number');
                $('#renameCategoryID').val(categoryId);
                $('#renameNewName').val(categoryName);
                $('#renameUniqueNumber').val(uniqueNumber);
                $('#renameModal').modal('show');
            });

            // Delete modal trigger
            $('.delete-btn').on('click', function () {
                var categoryId = $(this).data('category-id');
                var productCount = $(this).data('product-count');
                var message = "Are you sure you want to delete this category? This will delete " + productCount +
                    " product(s). If you want to keep those products, go to Manage Inventory, select the product, and change the category of the item.";
                $('#deleteModalMessage').text(message);
                $('#deleteCategoryID').val(categoryId);
                $('#deleteModal').modal('show');
            });
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>

}
